"use strict";(self.webpackChunkData_in_Design=self.webpackChunkData_in_Design||[]).push([[765],{37888:(e,t,a)=>{a.d(t,{v:()=>n});var r=a(24387);function n(e){e&&e.writtenProperties&&e.writtenProperties.forEach((e=>{let{target:t,propName:a,newOrigin:n}=e;(0,r.H)(t)&&n&&t.originOf(a)!==n&&t.updateOrigin(a,n)}))}},24387:(e,t,a)=>{function r(e){return e&&"getAtOrigin"in e&&"originOf"in e}a.d(t,{H:()=>r})},10765:(e,t,a)=>{a.r(t),a.d(t,{save:()=>N,saveAll:()=>D,saveAs:()=>K});var r=a(18690),n=a(50076),o=a(76460),l=a(30726),i=a(50346),s=a(37888),u=a(38451),c=a(13096),d=a(11668),y=a(31933),f=a(44568),p=a(70652),m=a(79942),v=a(72945);const w=o.A.getLogger("esri.layers.FeatureLayer"),A="Feature Service";function h(e,t){return"Layer (title: ".concat(e.title,", id: ").concat(e.id,") of type '").concat(e.declaredClass,"' ").concat(t)}function g(e,t){if(t.type!==A)throw new n.A("feature-layer:portal-item-wrong-type",h(e,'should have portal item of type "'.concat(A,'"')))}async function b(e){if(await e.load(),(0,y.Ov)(e))throw new n.A("feature-layer:save",h(e,"using an in-memory source cannot be saved to a portal item"))}async function S(e,t,a){"beforeSave"in e&&"function"==typeof e.beforeSave&&await e.beforeSave();const r=e.write({},t);return function(e,t){var a;let r=(null!==(a=e.messages)&&void 0!==a?a:[]).filter((e=>{let{type:t}=e;return"error"===t})).map((e=>{let{name:t,message:a,details:r}=e;return new n.A(t,a,r)}));if(null!==t&&void 0!==t&&t.ignoreUnsupported&&(r=r.filter((e=>{let{name:t}=e;return"layer:unsupported"!==t&&"symbol:unsupported"!==t&&"symbol-layer:unsupported"!==t&&"property:unsupported"!==t&&"url:unsupported"!==t}))),r.length>0)throw new n.A("feature-layer:save","Failed to save feature layer due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:r})}(t,a),r}function I(e){const{layer:t,layerJSON:a}=e;return t.isTable?{layers:[],tables:[a]}:{layers:[a],tables:[]}}function O(e){(0,v.LG)(e,v.Ce.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,a)=>a.indexOf(e)===t)))}async function L(e,t){var a;return/\/\d+\/?$/.test(null!==(a=e.url)&&void 0!==a?a:"")?I(t[0]):async function(e,t){const{layer:{url:a,customParameters:r,apiKey:n}}=t[0];let o=await e.fetchData("json");o&&null!=o.layers&&null!=o.tables||(o=await async function(e,t,a){var r,n;e||(e={}),(r=e).layers||(r.layers=[]),(n=e).tables||(n.tables=[]);const{url:o,customParameters:s,apiKey:c}=t,{serviceJSON:y,layersJSON:f}=await(0,d.Q)(o,{customParameters:s,apiKey:c}),p=E(e.layers,y.layers,a),m=E(e.tables,y.tables,a);e.layers=p.itemResources,e.tables=m.itemResources;const v=[...p.added,...m.added],w=f?[...f.layers,...f.tables]:[];return await async function(e,t,a,r){const n=t.map((e=>{let{id:t}=e;return new u.default({url:a,layerId:t,sourceJSON:r.find((e=>{let{id:a}=e;return a===t}))})}));await(0,i.Lx)(n.map((e=>e.load()))),n.forEach((t=>{const{layerId:a,loaded:r,defaultPopupTemplate:n}=t;r&&!(0,l.$I)(n)&&P(t,{id:a,popupInfo:n.toJSON()},e)}))}(e,v,o,w),e}(o,{url:null!==a&&void 0!==a?a:"",customParameters:r,apiKey:n},t.map((e=>e.layer.layerId))));for(const l of t)P(l.layer,l.layerJSON,o);return o}(e,t)}function E(e,t,a){const n=(0,r.iv)(e,t,((e,t)=>e.id===t.id));e=e.filter((e=>!n.removed.some((t=>t.id===e.id))));const o=n.added.map((e=>{let{id:t}=e;return{id:t}}));return o.forEach((t=>{let{id:a}=t;e.push({id:a})})),{itemResources:e,added:o.filter((e=>{let{id:t}=e;return!a.includes(t)}))}}function P(e,t,a){e.isTable?T(a.tables,t):T(a.layers,t)}function T(e,t){if(!e)return;const a=e.findIndex((e=>{let{id:a}=e;return a===t.id}));-1===a?e.push(t):e[a]=t}function J(e){const{portalItem:t}=e;return(0,y.fH)(e)&&!e.dynamicDataSource&&!(null===t||void 0===t||!t.loaded)&&t.type===A}const N=(0,i.sg)((async function(e,t){await b(e),function(e){const t=e.portalItem;if(!t)throw w.error("save: requires the portalItem property to be set"),new n.A("feature-layer:portal-item-not-set",h(e,"requires the portalItem property to be set"));if(!t.loaded)throw new n.A("feature-layer:portal-item-not-loaded",h(e,"cannot be saved to a portal item that does not exist or is inaccessible"));g(e,t)}(e);const a=e.portalItem,r=(0,m.m)(a),o=await S(e,r,t),l=await L(a,[{layer:e,layerJSON:o}]);return O(a),await a.update({data:l}),(0,s.v)(r),a}));const D=(0,i.sg)((async(e,t)=>{await async function(e){if(null===e||void 0===e||!e.length)throw new n.A("feature-layer-utils-saveall:missing-parameters","'layers' array should contain at least one feature layer");await Promise.all(e.map((e=>e.load())));for(const r of e)if(!J(r))throw new n.A("feature-layer-utils-saveall:invalid-parameters","'layers' array should only contain layers or tables in a feature service loaded from 'Feature Service' item. ".concat(h(r,"does not conform")),{layer:r});const t=e.map((e=>e.portalItem.id));if(new Set(t).size>1)throw new n.A("feature-layer-utils-saveall:invalid-parameters","All layers in the 'layers' array should be loaded from the same portal item");const a=e.map((e=>e.layerId));if(new Set(a).size!==a.length)throw new n.A("feature-layer-utils-saveall:invalid-parameters","'layers' array should contain only one instance each of layer or table in a feature service")}(e);const a=e[0].portalItem,r=(0,m.m)(a),o=await Promise.all(e.map((e=>S(e,r,t)))),l=await L(a,e.map(((e,t)=>({layer:e,layerJSON:o[t]}))));return O(a),await a.update({data:l}),await Promise.all(e.slice(1).map((e=>e.portalItem.reload()))),(0,s.v)(r),a.clone()})),K=(0,i.sg)((async function(e,t,a){await b(e);const r=function(e,t){var a,r,n,o;let l=p.default.from(t);return l.id&&(l=l.clone(),l.id=null),null!==(a=(n=l).type)&&void 0!==a||(n.type=A),null!==(r=(o=l).portal)&&void 0!==r||(o.portal=f.A.getDefault()),g(e,l),l}(e,t),n=(0,m.m)(r),o=I({layer:e,layerJSON:await S(e,n,a)});return await async function(e,t){const{url:a,layerId:r,title:n,fullExtent:o,isTable:i}=e,s=(0,c.qg)(a),u=(0,l.Ru)(s)&&"FeatureServer"===s.serverType;t.url=u?a:"".concat(a,"/").concat(r),t.title||(t.title=n),t.extent=null,!i&&(0,l.Ru)(o)&&(t.extent=await(0,v.sQ)(o)),(0,v.OM)(t,v.Ce.METADATA),(0,v.OM)(t,v.Ce.MULTI_LAYER),(0,v.LG)(t,v.Ce.SINGLE_LAYER),i&&(0,v.LG)(t,v.Ce.TABLE),O(t)}(e,r),await async function(e,t,a){var r;const n=e.portal;await(null===n||void 0===n?void 0:n._signIn()),await(null===n||void 0===n||null===(r=n.user)||void 0===r?void 0:r.addItem({item:e,data:t,folder:null===a||void 0===a?void 0:a.folder}))}(r,o,a),e.portalItem=r,(0,s.v)(n),r}))},11668:(e,t,a)=>{a.d(t,{O:()=>i,Q:()=>o});var r=a(8),n=a(3825);async function o(e,t){var a,r,n;let o=await i(e,t);o=o||{},o.layers=(null===(a=o.layers)||void 0===a?void 0:a.filter(l))||[];const s={serviceJSON:o};if((null!==(r=o.currentVersion)&&void 0!==r?r:0)<10.5)return s;const u=await i(e+"/layers",t);return s.layersJSON={layers:(null===u||void 0===u||null===(n=u.layers)||void 0===n?void 0:n.filter(l))||[],tables:(null===u||void 0===u?void 0:u.tables)||[]},s}function l(e){return!e.type||"Feature Layer"===e.type}async function i(e,t){return(await(0,n.default)(e,{responseType:"json",query:(0,r.A)((0,r.A)({f:"json"},null===t||void 0===t?void 0:t.customParameters),{},{token:null===t||void 0===t?void 0:t.apiKey})})).data}},79942:(e,t,a)=>{a.d(t,{m:()=>l,v:()=>o});var r=a(90534),n=a(44568);function o(e){return{origin:"portal-item",url:(0,r.An)(e.itemUrl),portal:e.portal||n.A.getDefault(),portalItem:e,readResourcePaths:[]}}function l(e){return{origin:"portal-item",messages:[],writtenProperties:[],url:e.itemUrl?(0,r.An)(e.itemUrl):null,portal:e.portal||n.A.getDefault(),portalItem:e}}},72945:(e,t,a)=>{a.d(t,{Ce:()=>c,LG:()=>l,OM:()=>s,Y:()=>i,sQ:()=>u});var r=a(305),n=a(13312),o=a(45417);function l(e,t){if(!i(e,t)){const a=e.typeKeywords;a?a.push(t):e.typeKeywords=[t]}}function i(e,t){var a;return!(null===(a=e.typeKeywords)||void 0===a||!a.includes(t))}function s(e,t){const a=e.typeKeywords;if(a){const e=a.indexOf(t);e>-1&&a.splice(e,1)}}async function u(e){const t=e.clone().normalize();let a;if(t.length>1)for(const r of t)a?r.width>a.width&&(a=r):a=r;else a=t[0];return async function(e){const t=e.spatialReference;if(t.isWGS84)return e.clone();if(t.isWebMercator)return(0,o.ci)(e);const a=n.A.WGS84;return await(0,r.uH)(t,a),(0,r.Cv)(e,a)}(a)}const c={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table"}}}]);
//# sourceMappingURL=765.03507b02.chunk.js.map