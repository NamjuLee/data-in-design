{"version":3,"file":"static/js/8697.b388a8bb.chunk.js","mappings":"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","sources":["CLASS_12_Design_Data_Visualization/LAB_Web_Visualization_3D_for_GIS/Slowzone_01_Point/index.ts"],"sourcesContent":["import * as THREE from 'three';\r\nimport { RendererThree, } from '../../../lib';\r\nimport { getJSONFromURL, distanceTo, MercatorProjection } from 'njscore';\r\n\r\n\r\nexport class Solution extends RendererThree {\r\n\r\n    streetOSM: any = [];\r\n    routesTreated: any = [];\r\n    routesControl: any = [];\r\n    zones30: any = [];\r\n\r\n    positions;\r\n    geometry;\r\n\r\n    raycaster = new THREE.Raycaster();\r\n    pointer = new THREE.Vector2();\r\n\r\n    mesh: THREE.Points;\r\n\r\n    sphere: THREE.Mesh;\r\n\r\n    constructor(id: string = 'main') {\r\n        super(id)\r\n\r\n        const light = new THREE.PointLight(0xffffff, 0.8);\r\n        this.camera.add(light);\r\n        this.scene.add(light);\r\n\r\n        this.raycaster = new THREE.Raycaster();\r\n        this.raycaster.params.Points.threshold = 0.8;\r\n        this.raycaster.far = 1000;\r\n\r\n        const sphereGeometry = new THREE.SphereGeometry(0.1, 32, 32);\r\n        const sphereMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff });\r\n        const sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);\r\n        this.sphere = sphere;\r\n        this.scene.add(sphere);\r\n\r\n        this.camera.position.set(0, 40, 48);\r\n\r\n        // ................................................................................\r\n        // your code goes here\r\n        getJSONFromURL('https://raw.githubusercontent.com/NamjuLee/data/master/Paris/street_osm.geojson').then((data) => {\r\n            for (let i = 0; i < data['features'].length; ++i) {\r\n                this.streetOSM.push(data['features'][i]['geometry']['coordinates']);\r\n            }\r\n            this.renderPoints(this.scene, this.streetOSM, [0, 1, 1]);\r\n            this.start();\r\n        });\r\n    }\r\n    public mouseMove(e: MouseEvent): void {\r\n        this.pointer.x = (e.offsetX / this.hostDiv.clientWidth) * 2 - 1;\r\n        this.pointer.y = - (e.offsetY / this.hostDiv.clientHeight) * 2 + 1;\r\n    }\r\n    public update(scene: THREE.Scene) {\r\n        this.raycaster.setFromCamera(this.pointer, this.camera);\r\n        const intersections = this.raycaster.intersectObjects([this.mesh], false);\r\n        const intersection = (intersections.length) > 0 ? intersections[0] : null;\r\n\r\n        if (intersection !== null) {\r\n            this.sphere.position.set(intersection.point.x, intersection.point.y, intersection.point.z);\r\n        }\r\n\r\n        let numVertices = this.mesh.geometry.attributes.position.count;\r\n        for (let i = 0; i < numVertices; i++) {\r\n            let o = this.mesh.geometry.attributes.position;\r\n\r\n            let x = o.getX(i);\r\n            let y = o.getY(i);\r\n            let z = o.getZ(i)\r\n\r\n            y = Math.sin(9 * x * z + this.t * 5)\r\n\r\n            y = y < 0 ? 0 : y;\r\n\r\n            let p = new THREE.Vector3(x, y, z);\r\n\r\n            this.mesh.geometry.attributes.position.setXYZ(i, p.x, p.y, p.z);\r\n\r\n            if (intersection !== null) {\r\n                y = distanceTo(x, y, z, intersection.point.x, intersection.point.y, intersection.point.z) / 30\r\n            }\r\n            this.mesh.geometry.attributes.color.setXYZ(i, y, 1 - y, 0);\r\n        }\r\n        this.mesh.geometry.attributes.position.needsUpdate = true;\r\n        this.mesh.geometry.attributes.color.needsUpdate = true;\r\n        this.mesh.geometry.computeVertexNormals();\r\n    }\r\n    public renderPoints = (scene: THREE.Scene, paths: any, color: number[]) => {\r\n        const geometry = new THREE.BufferGeometry();\r\n        const material = new THREE.PointsMaterial({ vertexColors: true, size: 0.75 });\r\n\r\n        const positions = [];\r\n        const colors = [];\r\n\r\n        const xOFf = -15478803.88731685;\r\n        const yOFf = -4766681.448690384;\r\n        const scale = 0.01;\r\n\r\n        for (let i = 0; i < paths.length; ++i) {\r\n            const route = paths[i]\r\n\r\n            for (let j = 0; j < route.length; ++j) {\r\n                for (let k = 0; k < route[j].length; ++k) {\r\n\r\n                    const [xPro, yPro] = MercatorProjection(route[j][k][0], route[j][k][1]);\r\n                    const x = (xPro + xOFf) * scale\r\n                    const y = (yPro + yOFf) * scale\r\n\r\n                    positions.push(x, 0, y)\r\n                    colors.push(color[0], color[1], color[2]);\r\n\r\n\r\n                }\r\n            }\r\n        }\r\n        geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));\r\n        geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));\r\n        geometry.computeBoundingSphere();\r\n        this.positions = positions;\r\n        this.geometry = geometry;\r\n        this.mesh = new THREE.Points(geometry, material);\r\n        scene.add(this.mesh);\r\n    }\r\n};"],"names":["Solution","RendererThree","constructor","super","arguments","length","undefined","streetOSM","routesTreated","routesControl","zones30","positions","geometry","raycaster","THREE","pointer","mesh","sphere","renderPoints","scene","paths","color","material","vertexColors","size","colors","i","route","j","k","xPro","yPro","MercatorProjection","x","y","push","setAttribute","computeBoundingSphere","this","add","light","camera","params","Points","threshold","far","sphereGeometry","sphereMaterial","position","set","getJSONFromURL","then","data","start","mouseMove","e","offsetX","hostDiv","clientWidth","offsetY","clientHeight","update","setFromCamera","intersections","intersectObjects","intersection","point","z","numVertices","attributes","count","o","getX","getY","getZ","Math","sin","t","p","setXYZ","distanceTo","needsUpdate","computeVertexNormals"],"sourceRoot":""}