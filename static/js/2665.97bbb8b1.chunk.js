"use strict";(self.webpackChunkdata_in_design=self.webpackChunkdata_in_design||[]).push([[2665],{22665:(e,t,n)=>{n.r(t),n.d(t,{default:()=>_});var s=n(98773),r=n(50076),i=n(76460),a=n(30726),o=n(50346),u=n(80963),l=n(98618),h=n(41607),c=n(24586),d=n(63616),y=n(10907),g=n(40098),p=n(47047),f=n(1900);class _{constructor(){this._queryEngine=null,this._customParameters=null,this._snapshotFeatures=async e=>{var t;const{objectIdField:n}=this._queryEngine,s=await(0,p.x$)(null!==(t=this._getFeatureUrl)&&void 0!==t?t:"",this._featureType.typeName,this._getFeatureOutputFormat,{customParameters:this._customParameters,dateFields:this._queryEngine.fieldsIndex.dateFields.map((e=>e.name)),signal:e});await(0,y.sO)(s),(0,o.Te)(e);const r=(0,y.bd)(s,{geometryType:this._queryEngine.geometryType,hasZ:!1,objectIdField:n});if(!(0,u.aI)(this._queryEngine.spatialReference,u.w5))for(const o of r)(0,a.Ru)(o.geometry)&&(o.geometry=(0,l.Ux)((0,c.Cv)((0,l.zv)(o.geometry,this._queryEngine.geometryType,!1,!1),u.w5,this._queryEngine.spatialReference)));let i=1;for(const a of r){const e={};(0,g.MB)(this._fieldsIndex,e,a.attributes,!0),a.attributes=e,null==a.attributes[n]&&(a.objectId=a.attributes[n]=i++)}return r}}destroy(){var e;null!==(e=this._queryEngine)&&void 0!==e&&e.destroy(),this._queryEngine=null}async load(e,t){const{getFeatureUrl:n,getFeatureOutputFormat:s,spatialReference:r,fields:i,geometryType:u,featureType:l,objectIdField:c,customParameters:y}=e;this._featureType=l,this._customParameters=y,this._getFeatureUrl=n,this._getFeatureOutputFormat=s,this._fieldsIndex=new f.A(i),await this._checkProjection(r),(0,o.Te)(t),this._queryEngine=new d.d({fields:i,geometryType:u,hasM:!1,hasZ:!1,objectIdField:c,spatialReference:r,timeInfo:null,featureStore:new h.A({geometryType:u,hasM:!1,hasZ:!1})});const g=await this._snapshotFeatures((0,a.oA)(t.signal));return this._queryEngine.featureStore.addMany(g),{extent:this._queryEngine.fullExtent}}async applyEdits(){throw new r.A("wfs-source:editing-not-supported","applyEdits() is not supported on WFSLayer")}async queryFeatures(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForIds(e,t.signal)}async queryExtent(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForSnapping(e,t.signal)}async refresh(e){var t;return this._customParameters=e,null!==(t=this._snapshotTask)&&void 0!==t&&t.abort(),this._snapshotTask=(0,s.UT)(this._snapshotFeatures),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),e&&this._queryEngine.featureStore.addMany(e)}),(e=>{this._queryEngine.featureStore.clear(),(0,o.zf)(e)||i.A.getLogger("esri.layers.WFSLayer").error(new r.A("wfs-layer:getfeature-error","An error occurred during the GetFeature request",{error:e}))})),await this._waitSnapshotComplete(),{extent:this._queryEngine.fullExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch(e){}return this._waitSnapshotComplete()}}async _checkProjection(e){try{await(0,c.Nk)(u.w5,e)}catch(t){throw new r.A("unsupported-projection","Projection not supported",{spatialReference:e})}}}},40098:(e,t,n)=>{n.d(t,{$1:()=>f,CR:()=>p,MB:()=>d,Yx:()=>u,bP:()=>h});var s=n(30726),r=n(80963),i=n(32808);class a{constructor(){this.code=null,this.description=null}}class o{constructor(e){this.error=new a,this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error.description=e}}function u(e){return new o(e)}class l{constructor(e){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=e}}function h(e){return new l(e)}const c=new Set;function d(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4?arguments[4]:void 0;c.clear();for(const o in n){const a=e.get(o);if(!a)continue;const l=n[o],h=y(a,l);if(h!==l&&r&&r.push({name:"invalid-value-type",message:"attribute value was converted to match the field type",details:{field:a,originalValue:l,sanitizedValue:h}}),c.add(a.name),a&&(s||a.editable)){const e=(0,i.CJ)(a,h);if(e)return u((0,i.uo)(e,a,h));t[a.name]=h}}for(const i of null!==(a=null===e||void 0===e?void 0:e.requiredFields)&&void 0!==a?a:[]){var a;if(!c.has(i.name))return u('missing required field "'.concat(i.name,'"'))}return null}function y(e,t){let n=t;return"string"==typeof t&&(0,i.WA)(e)?n=parseFloat(t):null!=t&&(0,i.yM)(e)&&"string"!=typeof t&&(n=String(t)),(0,i.WX)(n)}let g;function p(e,t){if(!e||!(0,r.fn)(t))return e;if("rings"in e||"paths"in e){if((0,s.$I)(g))throw new TypeError("geometry engine not loaded");return g.simplify(t,e)}return e}async function f(e,t){!(0,r.fn)(e)||"esriGeometryPolygon"!==t&&"esriGeometryPolyline"!==t||await async function(){return(0,s.$I)(g)&&(g=await Promise.all([n.e(2612),n.e(4050)]).then(n.bind(n,1669))),g}()}}}]);
//# sourceMappingURL=2665.97bbb8b1.chunk.js.map